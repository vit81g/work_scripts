https://medium.com/@robert.broeckelmann/kerberos-wireshark-captures-a-spnego-example-e22e6b1d662a
https://www.wireshark.org/docs/dfref/k/kerberos.html

https://www.golinuxcloud.com/kerberos-auth-packet-analysis-wireshark/

Шаг 1. Запуск Wireshark
Шаг 2. Открыть PCAP файл ранее созданный (Destination 10.75.228.20 and Source 10.78.26.17)
Шаг 3. Navigate to Edit → Preferences and a window opens.
Шаг 4. Разверните дерево протоколов на левой панели и найдите KRB5 (Kerberos). Сначала выберите «Попробовать расшифровать объекты Kerberos», затем с помощью кнопки обзора добавьте файл таблицы ключей «ndc.keytab» и нажмите «ОК» для завершения.
Edit -> Preferences -> KRB5


Пакет 1: Клиент отправляет AS-REQ в AS. Пакет включает в себя заголовки ниже.
рисунок packet1
Далее ищем sname - это поле содержит запрашиваемое имя службы.

Пакет 2: поскольку клиент не включил данные предварительной аутентификации, AS отвечает кодом ошибки, запрашивая данные предварительной аутентификации.
рисунок packet2

Пакет 3: На этот раз клиент реконструирует AS-REQ с данными предварительной аутентификации и отправляет его в AS. Следующий вывод, отмеченный синим цветом, показывает расшифрованные данные, прошедшие предварительную проверку подлинности, которые содержат метку времени.
рисунок packet3

Пакет 4: AS отвечает пакетом AS-REP. Пакет содержит зашифрованный TGT и сеансовый ключ. Как видно ниже, поскольку TGT зашифрован главным ключом AS, клиент не сможет его расшифровать. Wireshark помечает незашифрованный пакет желтым цветом, а расшифрованные части показывает синим цветом. Клиент расшифровывает сеансовый ключ с помощью своего пароля.
рисунок packet4

Пакет 5: После получения TGT клиенты делают запрос (TGS-REQ) к TGS. Запрос содержит TGT и аутентификатор, зашифрованный сеансовым ключом клиента. С помощью этого запроса клиент запрашивает у сервера билет на обслуживание. Когда TGS получает запрос, он расшифровывает TGT с помощью главного ключа, совместно используемого с AS.
рисунок packet5

Пакет 6: TGS создает билет службы и шифрует его с помощью другого секретного ключа, который используется совместно TGS и файловым сервером. Билет службы включает такую информацию, как имя службы, идентификатор клиента, дата истечения срока действия, новый сеансовый ключ, адрес клиента и т. д. Одна копия нового сеансового ключа шифруется с помощью сеансового ключа клиента и вставляется в ответ.
рисунок packet6

 Билеты в Kerberos имеют ограниченный срок действия. Если билет украден, его будет сложно использовать повторно из-за необходимости строгой аутентификации.

