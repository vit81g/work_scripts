_______________________________________________________________________________
_______________________________________________________________________________
			Команды для составления ЖУЗап ОС UNIX:
_______________________________________________________________________________
_______________________________________________________________________________
cat /etc/passwd
login : password : UID : GID : GECOS : home : shell
(ex. stefands:x:13078:100:AIB:/home/stefands:/bin/bash)

Расшифровка параметров:

login - логин
password :- хэш пароля
UID - идентификатор пользователя
GID - идентификатор группы по умолчанию
GECOS - информационное поле
home - домашний каталог
shell - регистрационная оболочка
______________________________________________________________________________
______________________________________________________________________________
				Команды ОС UNIX:
______________________________________________________________________________
______________________________________________________________________________

Остановить вывод данных в ОС UNIX:
ctrl+S - остановить
ctrl+a - возобновитть
ctrl+c - отменить

Подключиться от одного сервера к другому:
ssh stefands@10.80.150.22

_____________________________________________________
Узнать версию ОС
_____________________________________________________
RHEL, CentOS, Red OS:
cat /etc/redhat-release
cat /etc/os-release
cat /etc/system-release
hostnamectl

zVirt:
hostnamectl - Раздел Operation System указывает на версию ОС zVirt
cat /etc/system-release - версия CentOS на базе которого развернут ОС zVirt
cat /etc/os-release - Раздел PRETTY_NAME указывает на версию ОС zVirt


Astra Linux:
cat /etc/astra_version

Solaris:
cat /etc/release

l-lenova
aq-aquarius



_____________________________________________________
Узнать IP-адрес:
_____________________________________________________
Хоста (ноды):

RHEL, CentOS, zVirt
hostname -i

Solaris
/usr/sbin/ifconfig -a (раздел inet xxx.xxx.xxx.xxx)

Linux
ifconfig -a (раздел aggr1 inet xxx.xxx.xxx.xxx)

КЛАСТЕРА:

nslookup <DNS имя кластера>




_____________________________________________________
Узнать имя хоста:
_____________________________________________________
hostname
uname -a
env




_____________________________________________________
Проверка доступности другого хоста:
_____________________________________________________
ping -c 4 cd11-l-zv007.codm.gazprom.loc




_____________________________________________________
Узнать наличие в ОС:
_____________________________________________________
Касперского:
ps -e |grep kesl

СУБД:
1. ps -e |grep oracle
   ps -e |grep postgres

2. cd /var/log/audit/oracle/
   ls - если есть файл аудита "oracle", то точно есть СУБД

3. cd /
   ls - если есть папка oracle, то точно есть СУБД (p.s. ps папка )
   (папка oracle лежит в одном каталоге с папками bin, boot, dev, etc, root и т.д.)





_____________________________________________________
Вывести все службы (в том числе выключенные):
_____________________________________________________
systemctl list-unit-files |grep kesl




___________________________________________________

Проверить сколько ip адресов назначено на одно имя хоста:
_____________________________________________________
host <hostname>




_____________________________________________________
Настройки параметра grep:
_____________________________________________________
ps -e |grep oracle - сделать фильтр по значению "oracle"
ps -e |grep -E 'oracle|postgres' - сделать одновременный фильтр по значениям "oracle" и "postgres"
ps -e |grep -v '^#' - вывести значения пропустив закомментированную строчку начинающуюся с #





_____________________________________________________
Проверить прописана ли прямая и обратная зоны в DNS для хоста:
_____________________________________________________
1. nslookup <hostname> - должен отобразиться ip-адрес хоста (ПРЯМАЯ ЗОНА)
2. nslookup <ip> - должно отобразиться имя хоста (ОБРАТНАЯ ЗОНА)



_____________________________________________________
cat /etc/hosts - позволяет ЖЕСТКО прописать соответствие имени хоста ip-адресу. Имеет приоритет над DNS. Позволяет вручную подминить ip-адрес для определенного хоста.

cat /etc/resolv.conf - позволяет вывести перечень DNS-записей на уровне ОС





___________________________________________________
Проверить отключен ли на хосте протокол TCP/IP v6:
___________________________________________________
ip addr|grep inet6
если вывод значений не пустой - значит протокол не отключен.

ip a show
если среди ответа есть упоминание inet6, следовательно протокол TCP/IP v6 не отключен.




___________________________________________________
Проверка Sudo:
___________________________________________________
sudo more /etc/sudoers
- - - - - - - - - - - - - - - - - - - - - - -
1. sudo more /etc/sudoers |grep auditvw - выводит перечень групп [ADM_IB ALL=(ALL), ADM_VSZIOS ALL=(ALL)] для которых настроен доступ типа NOPASSWD для роли auditvw 
2. sudo more /etc/sudoers |grep ADM_IB - в разделе User_Alias ADM_IB указан перечень AD групп, необходимых для беспарольного доступа в роль auditvw
3. getent group или cat /etc/group - дает полный перечень всех УЗ и групп в ОС
4. sudo more /etc/sudoers |grep root - просмотреть все группы с правами root
5. sudo  more /etc/sudoers |grep "User_Alias" - выводит все AD-группы, которые позволяют войти В ОС под определенными правами.

В sudoers:

%astra-admin - это группа astra-admin (%-маркер группы)
astra-admin - это УЗ astra-admin
NOPASSWD - вход в ОС без пароля

Для Astra linux - группа с полными админскими правами это ASTRA-ADMIN
Для все остальных Unix систем  - группа с полными админскими правами это WHEEL





___________________________________________________
Проверка отсутствия пакетов Telnet и TP
___________________________________________________

rpm -qa | grep -E 'ftp|telnet'

строки вывода должны отсутствовать 





___________________________________________________
Запуск EICAR на уровне ОС (создание вредоносного документа):
___________________________________________________

Из под auditvw выполнить команду:

1. echo -n 'X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*' > eicar.txt

2. cat eicar.txt - в случае если Касперский отработал корректно то появится сообщение "cat: eicar.txt: Операция не позволена"
___________________________________________________

Сменить пароль:
passwd

Имя учетки:
Whoami

Имя УЗ (для входа через УЗ), перечень AD групп в которые я вхожу (для входа через AD):
id

Выводит текущий id с auditvw
id|grep auditvw

Выйти:
Exit
q

Выполнить:
more - вывести данные на высоту экрана
cat - вывести все данные

Очистить экран:
Clear

Синтаксис команды:
--help

Перейти в корень каталога:
cd

Перейти на уровень выше каталога:
cd ..

Перейти на низний уровень каталога:
cd /

Перейти в каталог /var/log:
cd /var/log

Содержимое каталога:
ls - выводит перечень файлов в каталоге

ls -la - выводит перечень файлов в каталоге в виде таблицы с указанием даты последнего изменения
ex. drwxrwxr-x     5     www-data     www-data     4096     мар 28 17:02     Шамрай Е.Н
       (1)        (2)      (3)           (4)       (5)          (6)            (7)

(1) - права на папку (расшифровка ниже)
(2)
(3) - owner владелец каталога
(4) - group группа каталога
(5) - размер каталога
(6) - дата создания каталога
(7) - имя каталога

ls -la /usr/sap - позволяет посмотреть права доступа на папку trans в каталоге /usr/sap/
ex. drwxrwx--x  29 djcadm sapsys  4096 Dec 21 17:01 trans

r-- чтение,
-w- запись,
--x выполнение,
--t установлен блок на удаление,
--s позволяет обычным пользователям запускать файл от имени суперпользователя.

Первая буква "d" - это каталог (директория), "-" - это файл
Первая тройка букв - это права для OWNER (rwx)
Вторая тройка букв - это права для GROUP (rwx)
Третья тройка букв - это права для OTHER (--x)

ls -la / - проверка залинкованности папок на нижнем уровне каталога
Символ -> - указывает на залинкованность папок (ex. bin -> usr/bin означает что обращение к bin подразумевает обращиние к папке usr/bin (т.е. bin - это ярлык который ведет к usr/bin))

Выход из УЗ ОС:
exit

Последние пользователи в ОС:
last

Войди в роль АИБа:
su - auditvw

Войди в роль АИБа через AD (без ввода пароля):
sudo su - auditvw

Все УЗ хоста (Узнать uid УЗ):
cat /etc/passwd

Все УЗ хоста и группы (роли):
cat /etc/group

Проверка аудита (данный параметр должен на сто процентов соответствовать перечню УЗ в системе (/etc/group))
cat /etc/security/audit_user

Вывести все службы:
Systemctl list-units

Проверка параметра sssd.conf:
sudo more /etc/sssd/sssd.conf

Проверка параметра krb5.keyta:
sudo klist -k /etc/krb5.keytab

Контроль файлов настроек сервиса аудита:
cat /etc/audit/auditd.conf

Проверка статуса конкретной УЗ (краткая):
sudo passwd -S stefands

Проверка статуса конкретной УЗ (полная):
sudo chage -l stefand

Доступ к параметру МД RHEL (параметры файла матрицы привелегий функциональных ролей):
getfacl <имя параметра>
getfacl -e <имя параметра> - выводит ИТОГОВЫЕ права (с учетом маски)
--------------------------------------
owner = user
mask - маска, которая накладывается на все значения параметров, кроме "user:" (иначе говоря на все, кроме "extended permission" в таблице ОН).
mask имеет более высокий приоритет, чем root (режет права root)
имя owner и имя group должно соответствовать "#owner:root" и "#group:root" в системе
--------------------------------------

Доступ к параметру МД Solaris (параметры файла матрицы ролей):
ls -lV <имя параметра>

Проверка привелегий объектов среды виртуализации RHV:
getfacl /etc/audisp

Перечень отключаемых сервисов и компонент RHEL:
systemctl list-unit-files

Проверка статуса определённого типа УЗ: 
for users in `/bin/awk -F":" '{ if ( $5 == "AIB") print $1 }' /etc/passwd`;do sudo passwd -S "$users"; done
или
for users in `/bin/awk -F":" '{ if ( $5 == "Admin OS") print $1 }' /etc/passwd`;do sudo passwd -S "$users"; done
--------------------------------------
где AIB и Admin OS - это описание типа УЗ получаемого по команде "more /etc/passwd"

--------------------------------------

______________________________________________________________________________
Проверки статуса всех УЗ системы:
______________________________________________________________________________
for users in $(cut -f1 -d: /etc/passwd);do  sudo passwd -S "$users"; done

Расшифровка:
stefands PS 2021-07-12 1 30 7 -1 (Password set, SHA512 crypt.)
Расшифровка:
"stefands" - имя УЗ
"PS" - статус пароля: PS (password set - пароль задан) / LK (password locked - пароль заблокирован) / NP (no password - нет пароля)
"2021-07-12" - дата последнего изменения пароля
"1" - параметр -x: минимальный срок действия до смены пароля:  1 (срок действия пароля 1 день) / 0 (срок действия пароля 0 деней) / -1 (не задан минимальный срок джействия пароля)
"30" - параметр -w: максимальный срок действия до смены пароля: 30 (30 дней до смены пароля) / -1 (не установлен срок до смены пароля)
"7" - параметр -n: срок вывода предупреждения о смене пароля: 7 (предупреждение будет выведено за 7 дней до смены) / -1 (предупреждение не будет выведено)
"-1" - параметр -i: дезактивация пароля:  / 365 (пароль будет дезактивирован через 365 дней) / - 1 (дата дезактивации пароля не определена)
"(Password set, SHA512 crypt.)" - общая информация об УЗ
______________________________________________________________________________
Наличие свободного дискового пространства для хранения журналов аудита ОС :
______________________________________________________________________________
df -h - команда, которая выводит все АКТИВНЫЕ (не отключенные (не закомментированные) в конфигурационном файле fstab) диски на уровне ОС и отображает процент свободного места
--------------------------------------
Расшифровка:
Параметр Avail (оставшееся свободное место) - должен быть больше чем значение "admin_space_left" в ОН
и больше чем cat /etc/audit/auditd.conf строка "space_left"
--------------------------------------
______________________________________________________________________________
Общие сетевые диски и хранилища данных:
______________________________________________________________________________
cat /etc/fstab - конфигурационный файл, показывает все СУЩЕСТВУЮЩИЕ диски. Позволяет закомментировать (скрыть) определенный жесткий диск.
df -mh - команда которая выводит все АКТИВНЫЕ (не закоментированные fs tab) диски и показывает их объем.
______________________________________________________________________________
NFS-client и NFS-Server:
______________________________________________________________________________
для того чтобы узнать где на NFS-сервере (gpp-trans.codm.gazprom.loc) лежит общая транспортная папка, которая раздается на NFS-клиент (gpp-db21.codm.gazprom.loc), необходимо на уровне ОС NSF-клиента выполнить команду:
df -h
ex1. gpp-trans:/nfs/trans   345G   258G   74G   78%   /usr/sap/trans - общая транспортная папка /usr/sap/trans клиента (gpp-db21) находится на сервере (gpp-trans) по пути /nfs/trans

ex2. nfs-we-nbu:/usr/sap/trans     196G     27G     160G     15%     /usr/sap/trans - общая транспортная папка /usr/sap/trans клиента (pwe-db) находится на сервере (nfs-we) по пути /nfs/trans
______________________________________________________________________________
АУДИТ системы:
______________________________________________________________________________

Расположение журналов Аудита:
/var/log/audit/

Настройки Аудита:
/etc/audit/auditd.conf
/etc/audit/audit.rules

Проверить готовность сервиса аудита (из под УЗ auditctr):
service auditd status
(результат Active: active (running))

Просмотр журнала аудита определенного промежутка времени:
ausearch -ts 06/09/2023 16:00:01 -te 06/09/2023 17:16:00 	- дата для всех UNIX + морды zVirt (месяц/день/год)
ausearch -ts 09.06.2023 16:00:01 -te 09.06.2023 17:16:00 	- дата для zVirt (дата.месяц.год)

Просмотр журнала аудита с определенной даты по текущий момент:
ausearch -ts 06/09/2023 15:40:01 -te today	- дата для всех UNIX + морды zVirt (месяц/день/год)
ausearch -ts 09/06/2023 15:40:01 -te today 	- дата для zVirt (дата.месяц.год)

Если в журнале Лога дата отображается не корректно, то необходимо добавить параметр "-i":

Поиск событий аудита для УЗ GFSAS16
ausearch -ts today -i |grep GFSAS16|cat

Обращения к защищенным конфигурационным файлам (для поиска в определенном промежутке времени добавить ключи -ts 03/01/2022 16:00:00 -te 03/01/2022 17:16:00):
ausearch -i -k PG_CFG

Изменение времен:
ausearch -k time-change -i 

Изменение конфигурации запланированных заданий:
ausearch -k CFG_cron -i; ausearch -k CFG_crontab -i; ausearch -k CFG_crontab_root -i 

Изменение настроек PAM:
ausearch -k CFG_pam -i		

Изменение настроек идентификации и аутентификации пользователей:
ausearch -k identity -i

Изменение сетевых настроек системы:
ausearch -k system-locate -i

Изменение настроек ssh, scp, sftp:
ausearch -k sshconf -i

Доступ к журналам аудита:
ausearch -k LOG_audit -i

Изменение настроек аудита:
ausearch -k CFG_audit -i

Вход/выход пользователей за определенный период времени:
aureport --event -i -ts 03/01/2022 17:51:00 -te 03/01/2022 17:52:00

Запуск, завершение, изменение стартовых скриптов, демонов и программ:
ausearch -k prog -i

Изменение прав доступа и схемы владения файлами и папками:
ausearch -k perm_mod -i

Неавторизованные попытки доступа к файлам и папкам:
ausearch -k access -i

Использование привилегированных команд:
ausearch -k privileged -i

Удаление файлов и стартовых скриптов, демонов и программ:
ausearch -k delete -i

Действия (попытки) трассировки процессов:
ausearch -k tracing -i

Отслеживание попыток обойти аудит или программу наследования:
ausearch -k bypass -i

Отслеживание неудачных попыток переименования файлов и папок:
ausearch -k mods -i

Команды, выданные администратором ОС:
aureport --tty -i

Просмотр файлов аудита:
ausearch -f <name>
--------------------------------------
<name> необходимо заменить на имя файла аудита из каталога /var/log/audit/audit.log и т.д
--------------------------------------

Просмотр файлов аудита за текущий день:
aureport -ts today

Удаление файлов аудита:
rm -f /var/log/audit/<name>
--------------------------------------
<name> необходимо заменить на имя файла аудита из каталога /var/log/audit/audit.log и т.д
--------------------------------------

______________________________________________________________________________
Для RedOS:
______________________________________________________________________________

ausearch -m SYSCALL -sv yes -ts 15.12.2022 15:08:00 -i 


______________________________________________________________________________
Журнал syslog:
______________________________________________________________________________

Настройки журналов Syslog:
/etc/audisp/plugins.d/syslog.conf

Проверить готовность сервиса rsyslog (из под УЗ auditctr):
service syslog status
(результат Active: active (running))

Анализ журналов syslog:
bzmore /etc/audisp/plugins.d/syslog.conf


___________________________________________________________________________________
Проверка групп и УЗ разработчиков после сдачи системы в постоянную эксплуатацию:
___________________________________________________________________________________

1. cat /etc/passwd - вывести все УЗ, найти чреди них УЗ разработчиков
2. cat /etc/group - вывести все группы, изучить состав групп, найти в этих группах УЗ разработчиков
3. id gladyulp - вывести все группы для каждой УЗ разработчика (например gladyulp)
4. for users in $(cut -f1 -d: /etc/passwd);do  sudo passwd -S "$users"; done - вывести все УЗ и проверить на предмет блокировки
   (ex: stefands P 12/20/2022 1 90 7 -1)
   Параметр 1 = 1 - УЗ активна / Параметр 1 = -1 - УЗ заблокирована
   Параметр 2 = 30 - дней до смены пароля / Параметр 2 = -1 - не установлено количество дней
   Параметр 3 = 7 - количество неправильных попыток / Параметр 3 = -1 - параметр не задан 
   Параметр 4 = -1 - окончание пароля / Параметр 4 = - 1  - дата окончания не определена
   Password set - пароль активен
5. sudo  more /etc/sudoers - вывести все значения SUDO
   (ex: root ALL=(ALL:ALL) ALL)
   root - это имя УЗ
   первое ALL - данное правило применимо ко всем хостам
   второе ALL - УЗ может запускать команды от лица всех ПОЛЬЗОВАТЕЛЕЙ
   третье ALL - УЗ может запускать команды от лица всех ГРУПП
   четвертое ALL - данное правило применимо ко всем командам
   т.е. Пользователь root может выполнять любые команды с помощью sudo после ввода пароля

   % - это маркер группы (%astra-admin - это группа astra-admin / astra-admin - это УЗ astra-admin)
   (ex: %astra-admin ALL=(ALL:ALL) ALL)
   группа astra-admin может выполнять любые команды от имени любого пользователя и от лица любой группы на любом хосте
   (ex: %admin_OS ALL=(ALL) ALL)
   группа admin_OS может выполнять любые команды от имени любого пользователя на любом хосте

   NOPASSWD - вход в ОС без пароля

6. sudo more /etc/sudoers |grep "astra-admin" - вывести все полномочия групп присвоенных УЗ разработчиков (например astra-admin)




























