# Скрипты для обработки хостов и логов EVTX

Этот репозиторий содержит набор Python-скриптов для обработки и анализа данных, связанных с хостами и Windows журналами событий (файлы .evtx). В наборе представлены инструменты для нормализации и сравнения списков хостов, а также для извлечения и анализа URL из логов.

## Файлы

- **kav_for_two.py**  
  Этот скрипт:
  - Читает Excel-файл (например, `kav_pk.xlsx`), содержащий хосты, и нормализует их (приводит к нижнему регистру, удаляет доменную часть) [&#8203;:contentReference[oaicite:0]{index=0}].
  - Сравнивает полученные хосты с данными из текстового файла `result.txt`.
  - Выводит отсутствующие в Excel файле хосты в файл (например, `missing_hosts.txt`).
  - Принимает три аргумента командной строки: путь к файлу `result.txt`, путь к Excel-файлу и путь к выходному файлу.




- **kav_mp_xls.py**  
  Этот скрипт реализует похожую задачу, но из-за того что используется сравнение множест, данные не достоверны:
  - Читает файл `result.txt` и Excel-файл (например, `kav_pk.xlsx`) со столбцом «Host Name», приводя данные к верхнему регистру [&#8203;:contentReference[oaicite:1]{index=1}].
  - Сравнивает множества хостов и сохраняет в выходной файл отсутствующие хосты.
  - Выводит статистику по количеству хостов в каждом файле.

- **site_report.py**  
  Скрипт предназначен для анализа журналов событий Windows:
  - Использует библиотеку [Evtx](https://pypi.org/project/Evtx/) для чтения файлов .evtx [&#8203;:contentReference[oaicite:2]{index=2}].
  - Извлекает доменные имена из URL, найденных в XML-записях, с помощью регулярного выражения.
  - Подсчитывает количество вхождений каждого домена и сохраняет результаты в текстовый файл с суффиксом `_sites.txt`.

- **site_report_good.py**  
  Улучшенная версия `site_report.py`:
  - Содержит подробные комментарии и обработку ошибок.
  - Выполняет те же функции по извлечению и подсчету доменов из .evtx файлов [&#8203;:contentReference[oaicite:3]{index=3}].

- **site_report_pandas.py**  
  Этот скрипт:
  - Парсит .evtx файл, извлекая ключевые поля (EventRecordID, TimeCreated, EventID, Level, Channel, Computer, EventData) из XML-записей [&#8203;:contentReference[oaicite:4]{index=4}].
  - Формирует pandas DataFrame для последующего анализа.
  - Выводит краткий отчет (например, подсчет событий по EventID) и сохраняет данные в CSV-файл (`parsed_logs.csv`).

- **sort.py**  
  Скрипт для нормализации и сортировки хостов:
  - Читает Excel-файл, извлекает хосты из одного из столбцов («Имя хоста», «Host Name» или «Hostname») и нормализует их (удаляет доменные части с помощью регулярных выражений) [&#8203;:contentReference[oaicite:5]{index=5}].
  - Сохраняет полученный список в CSV-файл.
  - Принимает имя входного файла в качестве аргумента командной строки.

- **sort_new.py**  
  Функционально идентичен `sort.py`:
  - Читает Excel-файл, нормализует и сортирует хосты, после чего сохраняет их в CSV-файл [&#8203;:contentReference[oaicite:6]{index=6}].
  - Принимает имя входного файла через аргументы командной строки.

## Требования

- Python 3.x
- Библиотеки:
  - [pandas](https://pandas.pydata.org/)
  - [openpyxl](https://openpyxl.readthedocs.io/) (для чтения Excel-файлов)
  - [Evtx](https://pypi.org/project/Evtx/) (для работы с файлами Windows .evtx)
  - Модуль `re` (регулярные выражения, входит в стандартную библиотеку)

## Использование

### Запуск скрипта для сравнения хостов (kav_for_two.py)

```bash
python script.py <result>.txt <file>.xlsx <report>.txt
```
В консоль:

    Количество хостов в kav_pk.xlsx.
    Количество хостов в result.txt.
    Количество отсутствующих хостов.
    Первые 5 отсутствующих хостов (для проверки).

В missing_hosts.txt: список отсутствующих хостов, отсортированный по алфавиту.


Запуск альтернативного скрипта для сравнения хостов (kav_mp_xls.py)

Убедитесь, что файлы result.txt и kav_pk.xlsx находятся в рабочей директории, затем запустите:

```bash
python kav_mp_xls.py
```

Запуск скриптов для анализа журналов событий (.evtx)

Для извлечения доменов из журнала:
```bash
python site_report.py <evtx_file>
```
или для улучшенной версии с расширенной обработкой ошибок:
```bash
python site_report_good.py <evtx_file>
```
Для парсинга .evtx файла с использованием pandas:
```bash
python site_report_pandas.py
```
Примечание: Проверьте, что путь к файлу .evtx указан правильно в скрипте.
Запуск скриптов для сортировки и нормализации хостов
```bash
python sort.py <input_file.xlsx>

или

python sort_new.py <input_file.xlsx>
```
Оба скрипта прочитают указанный Excel-файл, нормализуют имена хостов и сохранят результат в CSV-файл с тем же именем (но с расширением .csv).



